(()=>{var t={};t.id=386,t.ids=[386],t.modules={72934:t=>{"use strict";t.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:t=>{"use strict";t.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:t=>{"use strict";t.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:t=>{"use strict";t.exports=require("crypto")},32615:t=>{"use strict";t.exports=require("http")},35240:t=>{"use strict";t.exports=require("https")},68621:t=>{"use strict";t.exports=require("punycode")},76162:t=>{"use strict";t.exports=require("stream")},17360:t=>{"use strict";t.exports=require("url")},71568:t=>{"use strict";t.exports=require("zlib")},6005:t=>{"use strict";t.exports=require("node:crypto")},72705:(t,e,i)=>{"use strict";let r,s,n,a,o;i.r(e),i.d(e,{originalPathname:()=>eD,patchFetch:()=>eL,requestAsyncStorage:()=>eP,routeModule:()=>ek,serverHooks:()=>eR,staticGenerationAsyncStorage:()=>ex});var h,d,l,c,u,p,_,f,m,y,w,g,v,E,A,b,O,S,T,C={};i.r(C),i.d(C,{POST:()=>eI});var I=i(73278),k=i(45002),P=i(54877),x=i(78482),R=i(82569);i(76976),i(75256);var D=i(96030),L=i(15481),U=i(78238),N=class{constructor(){(0,U.Ko)(this,l),(0,U.Ko)(this,h,"clerk_telemetry_throttler"),(0,U.Ko)(this,d,864e5)}isEventThrottled(t){var e;if(!(0,U.ac)(this,l,p))return!1;let i=Date.now(),r=(0,U.U9)(this,l,c).call(this,t),s=null==(e=(0,U.ac)(this,l,u))?void 0:e[r];if(!s){let t={...(0,U.ac)(this,l,u),[r]:i};localStorage.setItem((0,U.ac)(this,h),JSON.stringify(t))}if(s&&i-s>(0,U.ac)(this,d)){let t=(0,U.ac)(this,l,u);delete t[r],localStorage.setItem((0,U.ac)(this,h),JSON.stringify(t))}return!!s}};h=new WeakMap,d=new WeakMap,l=new WeakSet,c=function(t){let{sk:e,pk:i,payload:r,...s}=t,n={...r,...s};return JSON.stringify(Object.keys({...r,...s}).sort().map(t=>n[t]))},u=function(){let t=localStorage.getItem((0,U.ac)(this,h));return t?JSON.parse(t):{}},p=function(){if("undefined"==typeof window)return!1;let t=window.localStorage;if(!t)return!1;try{let e="test";return t.setItem(e,e),t.removeItem(e),!0}catch(e){return e instanceof DOMException&&("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t.length>0&&t.removeItem((0,U.ac)(this,h)),!1}};var M={samplingRate:1,maxBufferSize:5,endpoint:"https://clerk-telemetry.com"},K=class{constructor(t){var e,i,r,s,n,a;(0,U.Ko)(this,g),(0,U.Ko)(this,_),(0,U.Ko)(this,f),(0,U.Ko)(this,m,{}),(0,U.Ko)(this,y,[]),(0,U.Ko)(this,w),(0,U.qx)(this,_,{maxBufferSize:null!=(e=t.maxBufferSize)?e:M.maxBufferSize,samplingRate:null!=(i=t.samplingRate)?i:M.samplingRate,disabled:null!=(r=t.disabled)&&r,debug:null!=(s=t.debug)&&s,endpoint:M.endpoint}),t.clerkVersion||"undefined"!=typeof window?(0,U.ac)(this,m).clerkVersion=null!=(n=t.clerkVersion)?n:"":(0,U.ac)(this,m).clerkVersion="",(0,U.ac)(this,m).sdk=t.sdk,(0,U.ac)(this,m).sdkVersion=t.sdkVersion,(0,U.ac)(this,m).publishableKey=null!=(a=t.publishableKey)?a:"";let o=(0,L.nQ)(t.publishableKey);o&&((0,U.ac)(this,m).instanceType=o.instanceType),t.secretKey&&((0,U.ac)(this,m).secretKey=t.secretKey.substring(0,16)),(0,U.qx)(this,f,new N)}get isEnabled(){var t;return!("development"!==(0,U.ac)(this,m).instanceType||(0,U.ac)(this,_).disabled||"undefined"!=typeof process&&(0,D.fQ)(process.env.CLERK_TELEMETRY_DISABLED))&&("undefined"==typeof window||null==(t=null==window?void 0:window.navigator)||!t.webdriver)}get isDebug(){return(0,U.ac)(this,_).debug||"undefined"!=typeof process&&(0,D.fQ)(process.env.CLERK_TELEMETRY_DEBUG)}record(t){let e=(0,U.U9)(this,g,T).call(this,t.event,t.payload);(0,U.U9)(this,g,O).call(this,e.event,e),(0,U.U9)(this,g,v).call(this,e,t.eventSamplingRate)&&((0,U.ac)(this,y).push(e),(0,U.U9)(this,g,A).call(this))}};function $(t){let e={...t},i=(0,x.gf)(e),r=(0,x.sA)({options:e,apiClient:i}),s=new K({...t.telemetry,publishableKey:e.publishableKey,secretKey:e.secretKey,...e.sdkMetadata?{sdk:e.sdkMetadata.name,sdkVersion:e.sdkMetadata.version}:{}});return{...i,...r,telemetry:s}}_=new WeakMap,f=new WeakMap,m=new WeakMap,y=new WeakMap,w=new WeakMap,g=new WeakSet,v=function(t,e){return this.isEnabled&&!this.isDebug&&(0,U.U9)(this,g,E).call(this,t,e)},E=function(t,e){let i=Math.random();return!(0,U.ac)(this,f).isEventThrottled(t)&&i<=(0,U.ac)(this,_).samplingRate&&(void 0===e||i<=e)},A=function(){if("undefined"==typeof window){(0,U.U9)(this,g,b).call(this);return}if((0,U.ac)(this,y).length>=(0,U.ac)(this,_).maxBufferSize){(0,U.ac)(this,w)&&("undefined"!=typeof cancelIdleCallback?cancelIdleCallback:clearTimeout)((0,U.ac)(this,w)),(0,U.U9)(this,g,b).call(this);return}(0,U.ac)(this,w)||("requestIdleCallback"in window?(0,U.qx)(this,w,requestIdleCallback(()=>{(0,U.U9)(this,g,b).call(this)})):(0,U.qx)(this,w,setTimeout(()=>{(0,U.U9)(this,g,b).call(this)},0)))},b=function(){fetch(new URL("/v1/event",(0,U.ac)(this,_).endpoint),{method:"POST",body:JSON.stringify({events:(0,U.ac)(this,y)}),headers:{"Content-Type":"application/json"}}).catch(()=>void 0).then(()=>{(0,U.qx)(this,y,[])}).catch(()=>void 0)},O=function(t,e){this.isDebug&&(void 0!==console.groupCollapsed?(console.groupCollapsed("[clerk/telemetry]",t),console.log(e),console.groupEnd()):console.log("[clerk/telemetry]",t,e))},S=function(){let t={name:(0,U.ac)(this,m).sdk,version:(0,U.ac)(this,m).sdkVersion};return"undefined"!=typeof window&&window.Clerk&&(t={...t,...window.Clerk.constructor.sdkMetadata}),t},T=function(t,e){var i,r;let s=(0,U.U9)(this,g,S).call(this);return{event:t,cv:null!=(i=(0,U.ac)(this,m).clerkVersion)?i:"",it:null!=(r=(0,U.ac)(this,m).instanceType)?r:"",sdk:s.name,sdkv:s.version,...(0,U.ac)(this,m).publishableKey?{pk:(0,U.ac)(this,m).publishableKey}:{},...(0,U.ac)(this,m).secretKey?{sk:(0,U.ac)(this,m).secretKey}:{},payload:e}},(0,R.A)(x.WX);var j=i(9833),z=i(64694),B=i(7222);let q=require("node:async_hooks");i(71309);let H=new q.AsyncLocalStorage;var W=i(38833),G=i(59748);let J={secretKey:W.Cn,publishableKey:W.Am,apiUrl:W.T5,apiVersion:W.Gn,userAgent:"@clerk/nextjs@5.6.4",proxyUrl:W.NM,domain:W.yK,isSatellite:W.lo,sdkMetadata:W.nE,telemetry:{disabled:W.CY,debug:W.w4}},Y=t=>$({...J,...t}),F=$(J),V=new Proxy(Object.assign(()=>{var t,e;let i;try{let t=(0,B.vX)(),e=(0,G.Pg)(t,j._G.Headers.ClerkRequestData);i=(0,G.om)(e)}catch(t){if(t&&(0,B.mx)(t))throw t}let r=null!=(e=null==(t=H.getStore())?void 0:t.get("requestData"))?e:i;return(null==r?void 0:r.secretKey)||(null==r?void 0:r.publishableKey)?Y(r):F},F),{get:(t,e,i)=>((0,z.x9)("clerkClient singleton","Use `clerkClient()` as a function instead."),Reflect.get(t,e,i))});var X=i(79819);async function Q(){i(87594);let{userId:t}=(0,X.I)();return t?V().users.getUser(t):null}var Z=Object.defineProperty,tt="@liveblocks/core",te="2.8.2",ti="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function tr(t){console.error(t)}function ts(t,e,i){let r=Symbol.for(t),s=i?`${e||"dev"} (${i})`:e||"dev";ti[r]?ti[r]===s||tr(`Multiple copies of Liveblocks are being loaded in your project. This will cause issues! See https://liveblocks.io/docs/errors/dupes 

Conflicts:
- ${t} ${ti[r]} (already loaded)
- ${t} ${s} (trying to load this now)`):ti[r]=s,e&&te&&e!==te&&tr(`Cross-linked versions of Liveblocks found, which will cause issues! See https://liveblocks.io/docs/errors/cross-linked 

Conflicts:
- ${tt} is at ${te}
- ${t} is at ${e}

Always upgrade all Liveblocks packages to the same version number.`)}function tn(t,e){throw Error(e)}function ta(t,e="Expected value to be non-nullable"){return t}function to(){let t=new Set,e=new Set,i=null;function r(t){return e.add(t),()=>e.delete(t)}function s(e){return t.add(e),()=>t.delete(e)}async function n(t){let e;return new Promise(i=>{e=r(e=>{(void 0===t||t(e))&&i(e)})}).finally(()=>e?.())}function a(i){t.forEach(t=>t(i)),t.clear(),e.forEach(t=>t(i))}return{notify:function(t){null!==i?i.push(t):a(t)},subscribe:r,subscribeOnce:s,_forceClear:function(){t.clear(),e.clear()},count:function(){return t.size+e.size},waitUntil:n,pause:function(){i=[]},unpause:function(){if(null!==i){for(let t of i)a(t);i=null}},observable:{subscribe:r,subscribeOnce:s,waitUntil:n}}}((t,e)=>{for(var i in e)Z(t,i,{get:e[i],enumerable:!0})})({},{error:()=>tc,errorWithTitle:()=>t_,warn:()=>tl,warnWithTitle:()=>tp});var th="background:#0e0d12;border-radius:9999px;color:#fff;padding:3px 7px;font-family:sans-serif;font-weight:600;";function td(t){return"undefined"==typeof window?console[t]:(e,...i)=>console[t]("%cLiveblocks",th,e,...i)}var tl=td("warn"),tc=td("error");function tu(t){return"undefined"==typeof window?console[t]:(e,i,...r)=>console[t](`%cLiveblocks%c ${e}`,th,"font-weight:600",i,...r)}var tp=tu("warn"),t_=tu("error"),tf=class{constructor(t){this.curr=t}get current(){return this.curr}allowPatching(t){let e=this,i=!0;t({...this.curr,patch(t){if(i)for(let i of(e.curr=Object.assign({},e.curr,t),Object.entries(t))){let[t,e]=i;"patch"!==t&&(this[t]=e)}else throw Error("Can no longer patch stale context")}}),i=!1}},tm=1;function ty(t){return null!==t&&"object"==typeof t&&"[object Object]"===Object.prototype.toString.call(t)}function tw(t){return JSON.parse(JSON.stringify(t))}var tg=((r=tg||{})[r.UPDATE_PRESENCE=100]="UPDATE_PRESENCE",r[r.USER_JOINED=101]="USER_JOINED",r[r.USER_LEFT=102]="USER_LEFT",r[r.BROADCASTED_EVENT=103]="BROADCASTED_EVENT",r[r.ROOM_STATE=104]="ROOM_STATE",r[r.INITIAL_STORAGE_STATE=200]="INITIAL_STORAGE_STATE",r[r.UPDATE_STORAGE=201]="UPDATE_STORAGE",r[r.REJECT_STORAGE_OP=299]="REJECT_STORAGE_OP",r[r.UPDATE_YDOC=300]="UPDATE_YDOC",r[r.THREAD_CREATED=400]="THREAD_CREATED",r[r.THREAD_DELETED=407]="THREAD_DELETED",r[r.THREAD_METADATA_UPDATED=401]="THREAD_METADATA_UPDATED",r[r.THREAD_UPDATED=408]="THREAD_UPDATED",r[r.COMMENT_CREATED=402]="COMMENT_CREATED",r[r.COMMENT_EDITED=403]="COMMENT_EDITED",r[r.COMMENT_DELETED=404]="COMMENT_DELETED",r[r.COMMENT_REACTION_ADDED=405]="COMMENT_REACTION_ADDED",r[r.COMMENT_REACTION_REMOVED=406]="COMMENT_REACTION_REMOVED",r),tv=((s=tv||{})[s.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",s[s.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",s[s.UNEXPECTED_CONDITION=1011]="UNEXPECTED_CONDITION",s[s.TRY_AGAIN_LATER=1013]="TRY_AGAIN_LATER",s[s.INVALID_MESSAGE_FORMAT=4e3]="INVALID_MESSAGE_FORMAT",s[s.NOT_ALLOWED=4001]="NOT_ALLOWED",s[s.MAX_NUMBER_OF_MESSAGES_PER_SECONDS=4002]="MAX_NUMBER_OF_MESSAGES_PER_SECONDS",s[s.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS=4003]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS",s[s.MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP=4004]="MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP",s[s.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM=4005]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM",s[s.ROOM_ID_UPDATED=4006]="ROOM_ID_UPDATED",s[s.KICKED=4100]="KICKED",s[s.TOKEN_EXPIRED=4109]="TOKEN_EXPIRED",s[s.CLOSE_WITHOUT_RETRY=4999]="CLOSE_WITHOUT_RETRY",s),tE=[250,500,1e3,2e3,4e3,8e3,1e4];function tA(t,e){return e.find(e=>e>t)??e[e.length-1]}tE[0];(function(t,e){let i=tl;()=>{i(e)}})(1,"Connection to WebSocket closed permanently. Won't retry.");Symbol(),to().observable,Date.now();function tb(t){let e=t.editedAt?new Date(t.editedAt):void 0,i=new Date(t.createdAt),r=t.reactions.map(t=>({...t,createdAt:new Date(t.createdAt)}));if(t.body)return{...t,reactions:r,createdAt:i,editedAt:e};{let s=new Date(t.deletedAt);return{...t,reactions:r,createdAt:i,editedAt:e,deletedAt:s}}}function tO(t){let e=t.updatedAt?new Date(t.updatedAt):void 0,i=new Date(t.createdAt),r=t.comments.map(t=>tb(t));return{...t,createdAt:i,updatedAt:e,comments:r}}function tS(t){let e=new Date(t.notifiedAt),i=t.readAt?new Date(t.readAt):null;if("activities"in t){let r=t.activities.map(t=>({...t,createdAt:new Date(t.createdAt)}));return{...t,notifiedAt:e,readAt:i,activities:r}}return{...t,notifiedAt:e,readAt:i}}function tT(t,e,i){let r=new URL(e,t);return void 0!==i&&(r.search=(i instanceof URLSearchParams?i:function(t){let e=new URLSearchParams;for(let[i,r]of Object.entries(t))null!=r&&e.set(i,r.toString());return e}(i)).toString()),r.toString()}function tC(t,...e){return t.reduce((t,i,r)=>t+encodeURIComponent(e[r-1]??"")+i)}var tI=tx(0),tk=tx(1),tP=tI+tx(-1);function tx(t){let e=32+(t<0?95+t:t);if(e<32||e>126)throw Error(`Invalid n value: ${t}`);return String.fromCharCode(e)}function tR(t,e){return void 0!==t&&void 0!==e?function(t,e){if(t<e)return tD(t,e);if(t>e)return tD(e,t);throw Error("Cannot compute value between two equal positions")}(t,e):void 0!==t?function(t){for(let e=0;e<=t.length-1;e++){let i=t.charCodeAt(e);if(!(i>=126))return t.substring(0,e)+String.fromCharCode(i+1)}return t+tk}(t):void 0!==e?function(t){let e=t.length-1;for(let i=0;i<=e;i++){let r=t.charCodeAt(i);if(!(r<=32)){if(i!==e)return t.substring(0,i+1);if(33===r)return t.substring(0,i)+tP;return t.substring(0,i)+String.fromCharCode(r-1)}}return tk}(e):tk}function tD(t,e){let i=0,r=t.length,s=e.length;for(;;){let a=i<r?t.charCodeAt(i):32,o=i<s?e.charCodeAt(i):126;if(a===o){i++;continue}if(o-a!=1){var n;return((n=i)<t.length?t.substring(0,n):t+tI.repeat(n-t.length))+String.fromCharCode(o+a>>1)}{let e=i+1,r=t.substring(0,e);return r.length<e&&(r+=tI.repeat(e-r.length)),r+tD(t.substring(e),"")}}}function tL(t){return!function(t){if(""===t)return!1;let e=t.length-1,i=t.charCodeAt(e);if(i<33||i>126)return!1;for(let i=0;i<e;i++){let e=t.charCodeAt(i);if(e<32||e>126)return!1}return!0}(t)?function(t){let e=[];for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);e.push(r<32?32:r>126?126:r)}for(;e.length>0&&32===e[e.length-1];)e.length--;return e.length>0?String.fromCharCode(...e):tk}(t):t}var tU=((n=tU||{})[n.INIT=0]="INIT",n[n.SET_PARENT_KEY=1]="SET_PARENT_KEY",n[n.CREATE_LIST=2]="CREATE_LIST",n[n.UPDATE_OBJECT=3]="UPDATE_OBJECT",n[n.CREATE_OBJECT=4]="CREATE_OBJECT",n[n.DELETE_CRDT=5]="DELETE_CRDT",n[n.DELETE_OBJECT_KEY=6]="DELETE_OBJECT_KEY",n[n.CREATE_MAP=7]="CREATE_MAP",n[n.CREATE_REGISTER=8]="CREATE_REGISTER",n);function tN(t,e,i=tL(e)){return Object.freeze({type:"HasParent",node:t,key:e,pos:i})}var tM=Object.freeze({type:"NoParent"}),tK=class{constructor(){this._parent=tM}_getParentKeyOrThrow(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldKey;default:return tn(this.parent,"Unknown state")}}get _parentPos(){switch(this.parent.type){case"HasParent":return this.parent.pos;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldPos;default:return tn(this.parent,"Unknown state")}}get _pool(){return this.__pool}get roomId(){return this.__pool?this.__pool.roomId:null}get _id(){return this.__id}get parent(){return this._parent}get _parentKey(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":return null;case"Orphaned":return this.parent.oldKey;default:return tn(this.parent,"Unknown state")}}_apply(t,e){return 5===t.type&&"HasParent"===this.parent.type?this.parent.node._detachChild(this):{modified:!1}}_setParentLink(t,e){switch(this.parent.type){case"HasParent":if(this.parent.node!==t)throw Error("Cannot set parent: node already has a parent");this._parent=tN(t,e);return;case"Orphaned":case"NoParent":this._parent=tN(t,e);return;default:return tn(this.parent,"Unknown state")}}_attach(t,e){if(this.__id||this.__pool)throw Error("Cannot attach node: already attached");e.addNode(t,this),this.__id=t,this.__pool=e}_detach(){switch(this.__pool&&this.__id&&this.__pool.deleteNode(this.__id),this.parent.type){case"HasParent":this._parent=function(t,e=tL(t)){return Object.freeze({type:"Orphaned",oldKey:t,oldPos:e})}(this.parent.key,this.parent.pos);break;case"NoParent":this._parent=tM;break;case"Orphaned":break;default:tn(this.parent,"Unknown state")}this.__pool=void 0}invalidate(){(void 0!==this._cachedImmutable||void 0!==this._cachedTreeNode)&&(this._cachedImmutable=void 0,this._cachedTreeNode=void 0,"HasParent"===this.parent.type&&this.parent.node.invalidate())}toTreeNode(t){return(void 0===this._cachedTreeNode||this._cachedTreeNodeKey!==t)&&(this._cachedTreeNodeKey=t,this._cachedTreeNode=this._toTreeNode(t)),this._cachedTreeNode}toImmutable(){return void 0===this._cachedImmutable&&(this._cachedImmutable=this._toImmutable()),this._cachedImmutable}},t$=((a=t$||{})[a.OBJECT=0]="OBJECT",a[a.LIST=1]="LIST",a[a.MAP=2]="MAP",a[a.REGISTER=3]="REGISTER",a),tj=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((t,e)=>t+=(e&=63)<36?e.toString(36):e<62?(e-26).toString(36).toUpperCase():e<63?"_":"-",""),tz=class t extends tK{constructor(t){super(),this._data=t}get data(){return this._data}static _deserialize([e,i],r,s){let n=new t(i.data);return n._attach(e,s),n}_toOps(t,e,i){if(void 0===this._id)throw Error("Cannot serialize register if parentId or parentKey is undefined");return[{type:8,opId:i?.generateOpId(),id:this._id,parentId:t,parentKey:e,data:this.data}]}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveRegister if parent is missing");return{type:3,parentId:ta(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key,data:this.data}}_attachChild(t){throw Error("Method not implemented.")}_detachChild(t){throw Error("Method not implemented.")}_apply(t,e){return super._apply(t,e)}_toTreeNode(t){return{type:"Json",id:this._id??tj(),key:t,payload:this._data}}_toImmutable(){return this._data}clone(){return tw(this.data)}};function tB(t,e){let i=t._parentPos,r=e._parentPos;return i===r?0:i<r?-1:1}var tq=class t extends tK{constructor(t){let e;for(let i of(super(),this._items=[],this._implicitlyDeletedItems=new WeakSet,this._unacknowledgedSets=new Map,t)){let t=tR(e),r=t4(i);r._setParentLink(this,t),this._items.push(r),e=t}}static _deserialize([e],i,r){let s=new t([]);s._attach(e,r);let n=i.get(e);if(void 0===n)return s;for(let[t,e]of n){let n=t1([t,e],i,r);n._setParentLink(s,e.parentKey),s._insertAndSort(n)}return s}_toOps(t,e,i){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let r=[],s={id:this._id,opId:i?.generateOpId(),type:2,parentId:t,parentKey:e};for(let t of(r.push(s),this._items)){let e=t._getParentKeyOrThrow(),s=tV(t._toOps(this._id,e,i),void 0),n=s[0].opId;void 0!==n&&this._unacknowledgedSets.set(e,n),r.push(...s)}return r}_insertAndSort(t){this._items.push(t),this._sortItems()}_sortItems(){this._items.sort(tB),this.invalidate()}_indexOfPosition(t){return this._items.findIndex(e=>e._getParentKeyOrThrow()===t)}_attach(t,e){for(let i of(super._attach(t,e),this._items))i._attach(e.generateId(),e)}_detach(){for(let t of(super._detach(),this._items))t._detach()}_applySetRemote(t){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:e,parentKey:i}=t,r=t0(t);r._attach(e,this._pool),r._setParentLink(this,i);let s=t.deletedId,n=this._indexOfPosition(i);if(-1!==n){let e=this._items[n];if(e._id===s)return e._detach(),this._items[n]=r,{modified:tW(this,[tG(n,r)]),reverse:[]};{this._implicitlyDeletedItems.add(e),this._items[n]=r;let i=[tG(n,r)],s=this._detachItemAssociatedToSetOperation(t.deletedId);return s&&i.push(s),{modified:tW(this,i),reverse:[]}}}{let e=[],s=this._detachItemAssociatedToSetOperation(t.deletedId);return s&&e.push(s),this._insertAndSort(r),e.push(tY(this._indexOfPosition(i),r)),{reverse:[],modified:tW(this,e)}}}_applySetAck(t){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let e=[],i=this._detachItemAssociatedToSetOperation(t.deletedId);i&&e.push(i);let r=this._unacknowledgedSets.get(t.parentKey);if(void 0!==r){if(r!==t.opId)return 0===e.length?{modified:!1}:{modified:tW(this,e),reverse:[]};this._unacknowledgedSets.delete(t.parentKey)}let s=this._indexOfPosition(t.parentKey),n=this._items.find(e=>e._id===t.id);if(void 0!==n){if(n._parentKey===t.parentKey)return{modified:e.length>0&&tW(this,e),reverse:[]};-1!==s&&(this._implicitlyDeletedItems.add(this._items[s]),this._items.splice(s,1),e.push(tJ(s)));let i=this._items.indexOf(n);n._setParentLink(this,t.parentKey),this._sortItems();let r=this._items.indexOf(n);return r!==i&&e.push(tF(i,r,n)),{modified:e.length>0&&tW(this,e),reverse:[]}}{let i=this._pool.getNode(t.id);if(i&&this._implicitlyDeletedItems.has(i)){i._setParentLink(this,t.parentKey),this._implicitlyDeletedItems.delete(i),this._insertAndSort(i);let r=this._items.indexOf(i);return{modified:tW(this,[-1===s?tY(r,i):tG(r,i),...e]),reverse:[]}}{-1!==s&&this._items.splice(s,1);let{newItem:i,newIndex:r}=this._createAttachItemAndSort(t,t.parentKey);return{modified:tW(this,[-1===s?tY(r,i):tG(r,i),...e]),reverse:[]}}}}_detachItemAssociatedToSetOperation(t){if(void 0===t||void 0===this._pool)return null;let e=this._pool.getNode(t);if(void 0===e)return null;let i=this._detachChild(e);return!1===i.modified?null:i.modified.updates[0]}_applyRemoteInsert(t){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let e=tL(t.parentKey),i=this._indexOfPosition(e);-1!==i&&this._shiftItemPosition(i,e);let{newItem:r,newIndex:s}=this._createAttachItemAndSort(t,e);return{modified:tW(this,[tY(s,r)]),reverse:[]}}_applyInsertAck(t){let e=this._items.find(e=>e._id===t.id),i=tL(t.parentKey),r=this._indexOfPosition(i);if(e){if(e._parentKey===i)return{modified:!1};{let t=this._items.indexOf(e);-1!==r&&this._shiftItemPosition(r,i),e._setParentLink(this,i),this._sortItems();let s=this._indexOfPosition(i);return s===t?{modified:!1}:{modified:tW(this,[tF(t,s,e)]),reverse:[]}}}{let e=ta(this._pool).getNode(t.id);if(e&&this._implicitlyDeletedItems.has(e))return e._setParentLink(this,i),this._implicitlyDeletedItems.delete(e),this._insertAndSort(e),{modified:tW(this,[tY(this._indexOfPosition(i),e)]),reverse:[]};{-1!==r&&this._shiftItemPosition(r,i);let{newItem:e,newIndex:s}=this._createAttachItemAndSort(t,i);return{modified:tW(this,[tY(s,e)]),reverse:[]}}}}_applyInsertUndoRedo(t){let{id:e,parentKey:i}=t,r=t0(t);if(this._pool?.getNode(e)!==void 0)return{modified:!1};r._attach(e,ta(this._pool)),r._setParentLink(this,i);let s=this._indexOfPosition(i),n=i;return -1!==s&&(n=tR(this._items[s]?._parentPos,this._items[s+1]?._parentPos),r._setParentLink(this,n)),this._insertAndSort(r),{modified:tW(this,[tY(this._indexOfPosition(n),r)]),reverse:[{type:5,id:e}]}}_applySetUndoRedo(t){let{id:e,parentKey:i}=t,r=t0(t);if(this._pool?.getNode(e)!==void 0)return{modified:!1};this._unacknowledgedSets.set(i,ta(t.opId));let s=this._indexOfPosition(i);if(r._attach(e,ta(this._pool)),r._setParentLink(this,i),-1===s)return this._insertAndSort(r),this._detachItemAssociatedToSetOperation(t.deletedId),{reverse:[{type:5,id:e}],modified:tW(this,[tY(this._indexOfPosition(i),r)])};{let e=this._items[s];e._detach(),this._items[s]=r;let n=tV(e._toOps(ta(this._id),i,this._pool),t.id),a=[tG(s,r)],o=this._detachItemAssociatedToSetOperation(t.deletedId);return o&&a.push(o),{modified:tW(this,a),reverse:n}}}_attachChild(t,e){let i;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");return!1!==(i="set"===t.intent?1===e?this._applySetRemote(t):2===e?this._applySetAck(t):this._applySetUndoRedo(t):1===e?this._applyRemoteInsert(t):2===e?this._applyInsertAck(t):this._applyInsertUndoRedo(t)).modified&&this.invalidate(),i}_detachChild(t){if(t){let e=ta(t._parentKey),i=t._toOps(ta(this._id),e,this._pool),r=this._items.indexOf(t);return -1===r?{modified:!1}:(this._items.splice(r,1),this.invalidate(),t._detach(),{modified:tW(this,[tJ(r)]),reverse:i})}return{modified:!1}}_applySetChildKeyRemote(t,e){if(this._implicitlyDeletedItems.has(e))return this._implicitlyDeletedItems.delete(e),e._setParentLink(this,t),this._insertAndSort(e),{modified:tW(this,[tY(this._items.indexOf(e),e)]),reverse:[]};if(t===e._parentKey)return{modified:!1};let i=this._indexOfPosition(t);if(-1===i){let i=this._items.indexOf(e);e._setParentLink(this,t),this._sortItems();let r=this._items.indexOf(e);return r===i?{modified:!1}:{modified:tW(this,[tF(i,r,e)]),reverse:[]}}{this._items[i]._setParentLink(this,tR(t,this._items[i+1]?._parentPos));let r=this._items.indexOf(e);e._setParentLink(this,t),this._sortItems();let s=this._items.indexOf(e);return s===r?{modified:!1}:{modified:tW(this,[tF(r,s,e)]),reverse:[]}}}_applySetChildKeyAck(t,e){let i=ta(e._parentKey);if(this._implicitlyDeletedItems.has(e)){let i=this._indexOfPosition(t);return this._implicitlyDeletedItems.delete(e),-1!==i&&this._items[i]._setParentLink(this,tR(t,this._items[i+1]?._parentPos)),e._setParentLink(this,t),this._insertAndSort(e),{modified:!1}}{if(t===i)return{modified:!1};let r=this._items.indexOf(e),s=this._indexOfPosition(t);-1!==s&&this._items[s]._setParentLink(this,tR(t,this._items[s+1]?._parentPos)),e._setParentLink(this,t),this._sortItems();let n=this._items.indexOf(e);return r===n?{modified:!1}:{modified:tW(this,[tF(r,n,e)]),reverse:[]}}}_applySetChildKeyUndoRedo(t,e){let i=ta(e._parentKey),r=this._items.indexOf(e),s=this._indexOfPosition(t);-1!==s&&this._items[s]._setParentLink(this,tR(t,this._items[s+1]?._parentPos)),e._setParentLink(this,t),this._sortItems();let n=this._items.indexOf(e);return r===n?{modified:!1}:{modified:tW(this,[tF(r,n,e)]),reverse:[{type:1,id:ta(e._id),parentKey:i}]}}_setChildKey(t,e,i){return 1===i?this._applySetChildKeyRemote(t,e):2===i?this._applySetChildKeyAck(t,e):this._applySetChildKeyUndoRedo(t,e)}_apply(t,e){return super._apply(t,e)}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveList if parent is missing");return{type:1,parentId:ta(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get length(){return this._items.length}push(t){return this._pool?.assertStorageIsWritable(),this.insert(t,this.length)}insert(t,e){if(this._pool?.assertStorageIsWritable(),e<0||e>this._items.length)throw Error(`Cannot insert list item at index "${e}". index should be between 0 and ${this._items.length}`);let i=tR(this._items[e-1]?this._items[e-1]._parentPos:void 0,this._items[e]?this._items[e]._parentPos:void 0),r=t4(t);if(r._setParentLink(this,i),this._insertAndSort(r),this._pool&&this._id){let t=this._pool.generateId();r._attach(t,this._pool),this._pool.dispatch(r._toOps(this._id,i,this._pool),[{type:5,id:t}],new Map([[this._id,tW(this,[tY(e,r)])]]))}}move(t,e){if(this._pool?.assertStorageIsWritable(),e<0)throw Error("targetIndex cannot be less than 0");if(e>=this._items.length)throw Error("targetIndex cannot be greater or equal than the list length");if(t<0)throw Error("index cannot be less than 0");if(t>=this._items.length)throw Error("index cannot be greater or equal than the list length");let i=null,r=null;t<e?(r=e===this._items.length-1?void 0:this._items[e+1]._parentPos,i=this._items[e]._parentPos):(r=this._items[e]._parentPos,i=0===e?void 0:this._items[e-1]._parentPos);let s=tR(i,r),n=this._items[t],a=n._getParentKeyOrThrow();if(n._setParentLink(this,s),this._sortItems(),this._pool&&this._id){let i=new Map([[this._id,tW(this,[tF(t,e,n)])]]);this._pool.dispatch([{type:1,id:ta(n._id),opId:this._pool.generateOpId(),parentKey:s}],[{type:1,id:ta(n._id),parentKey:a}],i)}}delete(t){if(this._pool?.assertStorageIsWritable(),t<0||t>=this._items.length)throw Error(`Cannot delete list item at index "${t}". index should be between 0 and ${this._items.length-1}`);let e=this._items[t];if(e._detach(),this._items.splice(t,1),this.invalidate(),this._pool){let i=e._id;if(i){let r=new Map;r.set(ta(this._id),tW(this,[tJ(t)])),this._pool.dispatch([{id:i,opId:this._pool.generateOpId(),type:5}],e._toOps(ta(this._id),e._getParentKeyOrThrow()),r)}}}clear(){if(this._pool?.assertStorageIsWritable(),this._pool){let t=[],e=[],i=[];for(let r of this._items){r._detach();let s=r._id;s&&(t.push({type:5,id:s,opId:this._pool.generateOpId()}),e.push(...r._toOps(ta(this._id),r._getParentKeyOrThrow())),i.push(tJ(0)))}this._items=[],this.invalidate();let r=new Map;r.set(ta(this._id),tW(this,i)),this._pool.dispatch(t,e,r)}else{for(let t of this._items)t._detach();this._items=[],this.invalidate()}}set(t,e){if(this._pool?.assertStorageIsWritable(),t<0||t>=this._items.length)throw Error(`Cannot set list item at index "${t}". index should be between 0 and ${this._items.length-1}`);let i=this._items[t],r=i._getParentKeyOrThrow(),s=i._id;i._detach();let n=t4(e);if(n._setParentLink(this,r),this._items[t]=n,this.invalidate(),this._pool&&this._id){let e=this._pool.generateId();n._attach(e,this._pool);let a=new Map;a.set(this._id,tW(this,[tG(t,n)]));let o=tV(n._toOps(this._id,r,this._pool),s);this._unacknowledgedSets.set(r,ta(o[0].opId));let h=tV(i._toOps(this._id,r,void 0),e);this._pool.dispatch(o,h,a)}}toArray(){return this._items.map(t=>t3(t))}every(t){return this.toArray().every(t)}filter(t){return this.toArray().filter(t)}find(t){return this.toArray().find(t)}findIndex(t){return this.toArray().findIndex(t)}forEach(t){return this.toArray().forEach(t)}get(t){if(!(t<0)&&!(t>=this._items.length))return t3(this._items[t])}indexOf(t,e){return this.toArray().indexOf(t,e)}lastIndexOf(t,e){return this.toArray().lastIndexOf(t,e)}map(t){return this._items.map((e,i)=>t(t3(e),i))}some(t){return this.toArray().some(t)}[Symbol.iterator](){return new tH(this._items)}_createAttachItemAndSort(t,e){let i=t0(t);return i._attach(t.id,ta(this._pool)),i._setParentLink(this,e),this._insertAndSort(i),{newItem:i,newIndex:this._indexOfPosition(e)}}_shiftItemPosition(t,e){let i=tR(e,this._items.length>t+1?this._items[t+1]?._parentPos:void 0);this._items[t]._setParentLink(this,i)}_toTreeNode(t){return{type:"LiveList",id:this._id??tj(),key:t,payload:this._items.map((t,e)=>t.toTreeNode(e.toString()))}}toImmutable(){return super.toImmutable()}_toImmutable(){return this._items.map(t=>t.toImmutable())}clone(){return new t(this._items.map(t=>t.clone()))}},tH=class{constructor(t){this._innerIterator=t[Symbol.iterator]()}[Symbol.iterator](){return this}next(){let t=this._innerIterator.next();return t.done?{done:!0,value:void 0}:{value:t3(t.value)}}};function tW(t,e){return{node:t,type:"LiveList",updates:e}}function tG(t,e){return{index:t,type:"set",item:e instanceof tz?e.data:e}}function tJ(t){return{index:t,type:"delete"}}function tY(t,e){return{index:t,type:"insert",item:e instanceof tz?e.data:e}}function tF(t,e,i){return{index:e,type:"move",previousIndex:t,item:i instanceof tz?i.data:i}}function tV(t,e){return t.map((t,i)=>0===i?{...t,intent:"set",deletedId:e}:t)}var tX=t=>t,tQ=class t extends tK{constructor(t){if(super(),this.unacknowledgedSet=new Map,t){let e=[];for(let[i,r]of t){let t=t4(r);t._setParentLink(this,i),e.push([i,t])}this._map=new Map(e)}else this._map=new Map}_toOps(t,e,i){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let r=[],s={id:this._id,opId:i?.generateOpId(),type:7,parentId:t,parentKey:e};for(let[t,e]of(r.push(s),this._map))r.push(...e._toOps(this._id,t,i));return r}static _deserialize([e,i],r,s){let n=new t;n._attach(e,s);let a=r.get(e);if(void 0===a)return n;for(let[t,e]of a){let i=t1([t,e],r,s);i._setParentLink(n,e.parentKey),n._map.set(e.parentKey,i),n.invalidate()}return n}_attach(t,e){for(let[i,r]of(super._attach(t,e),this._map))t5(r)&&r._attach(e.generateId(),e)}_attachChild(t,e){let i;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:r,parentKey:s,opId:n}=t,a=t0(t);if(void 0!==this._pool.getNode(r))return{modified:!1};if(2===e){let t=this.unacknowledgedSet.get(s);if(t===n)return this.unacknowledgedSet.delete(s),{modified:!1};if(void 0!==t)return{modified:!1}}else 1===e&&this.unacknowledgedSet.delete(s);let o=this._map.get(s);if(o){let t=ta(this._id);i=o._toOps(t,s),o._detach()}else i=[{type:5,id:r}];return a._setParentLink(this,s),a._attach(r,this._pool),this._map.set(s,a),this.invalidate(),{modified:{node:this,type:"LiveMap",updates:{[s]:{type:"update"}}},reverse:i}}_detach(){for(let t of(super._detach(),this._map.values()))t._detach()}_detachChild(t){let e=ta(this._id),i=ta(t._parentKey),r=t._toOps(e,i,this._pool);for(let[e,i]of this._map)i===t&&(this._map.delete(e),this.invalidate());return t._detach(),{modified:{node:this,type:"LiveMap",updates:{[i]:{type:"delete"}}},reverse:r}}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveMap if parent is missing");return{type:2,parentId:ta(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get(t){let e=this._map.get(t);if(void 0!==e)return t3(e)}set(t,e){this._pool?.assertStorageIsWritable();let i=this._map.get(t);i&&i._detach();let r=t4(e);if(r._setParentLink(this,t),this._map.set(t,r),this.invalidate(),this._pool&&this._id){let e=this._pool.generateId();r._attach(e,this._pool);let s=new Map;s.set(this._id,{node:this,type:"LiveMap",updates:{[t]:{type:"update"}}});let n=r._toOps(this._id,t,this._pool);this.unacknowledgedSet.set(t,ta(n[0].opId)),this._pool.dispatch(r._toOps(this._id,t,this._pool),i?i._toOps(this._id,t):[{type:5,id:e}],s)}}get size(){return this._map.size}has(t){return this._map.has(t)}delete(t){this._pool?.assertStorageIsWritable();let e=this._map.get(t);if(void 0===e)return!1;if(e._detach(),this._map.delete(t),this.invalidate(),this._pool&&e._id){let i=ta(this._id),r=new Map;r.set(i,{node:this,type:"LiveMap",updates:{[t]:{type:"delete"}}}),this._pool.dispatch([{type:5,id:e._id,opId:this._pool.generateOpId()}],e._toOps(i,t),r)}return!0}entries(){let t=this._map.entries();return{[Symbol.iterator](){return this},next(){let e=t.next();return e.done?{done:!0,value:void 0}:{value:[e.value[0],t3(e.value[1])]}}}}[Symbol.iterator](){return this.entries()}keys(){return this._map.keys()}values(){let t=this._map.values();return{[Symbol.iterator](){return this},next(){let e=t.next();return e.done?{done:!0,value:void 0}:{value:t3(e.value)}}}}forEach(t){for(let e of this)t(e[1],e[0],this)}_toTreeNode(t){return{type:"LiveMap",id:this._id??tj(),key:t,payload:Array.from(this._map.entries()).map(([t,e])=>e.toTreeNode(t))}}toImmutable(){return super.toImmutable()}_toImmutable(){let t=new Map;for(let[e,i]of this._map)t.set(e,i.toImmutable());return tX(t)}clone(){return new t(Array.from(this._map).map(([t,e])=>[t,e.clone()]))}},tZ=class t extends tK{static _buildRootAndParentToChildren(t){let e=new Map,i=null;for(let[r,s]of t)if(0!==s.type||void 0!==s.parentId&&void 0!==s.parentKey){let t=[r,s],i=e.get(s.parentId);void 0!==i?i.push(t):e.set(s.parentId,[t])}else i=[r,s];if(null===i)throw Error("Root can't be null");return[i,e]}static _fromItems(e,i){let[r,s]=t._buildRootAndParentToChildren(e);return t._deserialize(r,s,i)}constructor(t={}){super(),this._propToLastUpdate=new Map;let e=function(t){let e={...t};return Object.keys(t).forEach(t=>{void 0===e[t]&&delete e[t]}),e}(t);for(let t of Object.keys(e)){let i=e[t];t5(i)&&i._setParentLink(this,t)}this._map=new Map(Object.entries(e))}_toOps(t,e,i){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let r=i?.generateOpId(),s=[],n={type:4,id:this._id,opId:r,parentId:t,parentKey:e,data:{}};for(let[t,e]of(s.push(n),this._map))t5(e)?s.push(...e._toOps(this._id,t,i)):n.data[t]=e;return s}static _deserialize([e,i],r,s){let n=new t(i.data);return n._attach(e,s),this._deserializeChildren(n,r,s)}static _deserializeChildren(t,e,i){let r=e.get(ta(t._id));if(void 0===r)return t;for(let[s,n]of r){let r=function([t,e],i,r){switch(e.type){case 0:return tZ._deserialize([t,e],i,r);case 1:return tq._deserialize([t,e],i,r);case 2:return tQ._deserialize([t,e],i,r);case 3:return e.data;default:throw Error("Unexpected CRDT type")}}([s,n],e,i);t6(r)&&r._setParentLink(t,n.parentKey),t._map.set(n.parentKey,r),t.invalidate()}return t}_attach(t,e){for(let[i,r]of(super._attach(t,e),this._map))t5(r)&&r._attach(e.generateId(),e)}_attachChild(t,e){let i;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:r,opId:s,parentKey:n}=t,a=t2(t);if(void 0!==this._pool.getNode(r))return this._propToLastUpdate.get(n)===s&&this._propToLastUpdate.delete(n),{modified:!1};if(0===e)this._propToLastUpdate.set(n,ta(s));else if(void 0===this._propToLastUpdate.get(n));else if(this._propToLastUpdate.get(n)===s)return this._propToLastUpdate.delete(n),{modified:!1};else return{modified:!1};let o=ta(this._id),h=this._map.get(n);return t5(h)?(i=h._toOps(o,n),h._detach()):i=void 0===h?[{type:6,id:o,key:n}]:[{type:3,id:o,data:{[n]:h}}],this._map.set(n,a),this.invalidate(),t6(a)&&(a._setParentLink(this,n),a._attach(r,this._pool)),{reverse:i,modified:{node:this,type:"LiveObject",updates:{[n]:{type:"update"}}}}}_detachChild(t){if(t){let e=ta(this._id),i=ta(t._parentKey),r=t._toOps(e,i,this._pool);for(let[e,i]of this._map)i===t&&(this._map.delete(e),this.invalidate());return t._detach(),{modified:{node:this,type:"LiveObject",updates:{[i]:{type:"delete"}}},reverse:r}}return{modified:!1}}_detach(){for(let t of(super._detach(),this._map.values()))t5(t)&&t._detach()}_apply(t,e){return 3===t.type?this._applyUpdate(t,e):6===t.type?this._applyDeleteObjectKey(t,e):super._apply(t,e)}_serialize(){let t={};for(let[e,i]of this._map)t5(i)||(t[e]=i);return"HasParent"===this.parent.type&&this.parent.node._id?{type:0,parentId:this.parent.node._id,parentKey:this.parent.key,data:t}:{type:0,data:t}}_applyUpdate(t,e){let i=!1,r=ta(this._id),s=[],n={type:3,id:r,data:{}};for(let e in t.data){let t=this._map.get(e);t5(t)?(s.push(...t._toOps(r,e)),t._detach()):void 0!==t?n.data[e]=t:void 0===t&&s.push({type:6,id:r,key:e})}let a={};for(let r in t.data){let s=t.data[r];if(void 0===s)continue;if(e)this._propToLastUpdate.set(r,ta(t.opId));else if(void 0===this._propToLastUpdate.get(r))i=!0;else{if(this._propToLastUpdate.get(r)!==t.opId)continue;this._propToLastUpdate.delete(r);continue}let n=this._map.get(r);t5(n)&&n._detach(),i=!0,a[r]={type:"update"},this._map.set(r,s),this.invalidate()}return 0!==Object.keys(n.data).length&&s.unshift(n),i?{modified:{node:this,type:"LiveObject",updates:a},reverse:s}:{modified:!1}}_applyDeleteObjectKey(t,e){let i=t.key;if(!1===this._map.has(i)||!e&&void 0!==this._propToLastUpdate.get(i))return{modified:!1};let r=this._map.get(i),s=ta(this._id),n=[];return t5(r)?(n=r._toOps(s,t.key),r._detach()):void 0!==r&&(n=[{type:3,id:s,data:{[i]:r}}]),this._map.delete(i),this.invalidate(),{modified:{node:this,type:"LiveObject",updates:{[t.key]:{type:"delete"}}},reverse:n}}toObject(){return Object.fromEntries(this._map)}set(t,e){this._pool?.assertStorageIsWritable(),this.update({[t]:e})}get(t){return this._map.get(t)}delete(t){let e;this._pool?.assertStorageIsWritable();let i=this._map.get(t);if(void 0===i)return;if(void 0===this._pool||void 0===this._id){t5(i)&&i._detach(),this._map.delete(t),this.invalidate();return}t5(i)?(i._detach(),e=i._toOps(this._id,t)):e=[{type:3,data:{[t]:i},id:this._id}],this._map.delete(t),this.invalidate();let r=new Map;r.set(this._id,{node:this,type:"LiveObject",updates:{[t]:{type:"delete"}}}),this._pool.dispatch([{type:6,key:t,id:this._id,opId:this._pool.generateOpId()}],e,r)}update(t){if(this._pool?.assertStorageIsWritable(),void 0===this._pool||void 0===this._id){for(let e in t){let i=t[e];if(void 0===i)continue;let r=this._map.get(e);t5(r)&&r._detach(),t5(i)&&i._setParentLink(this,e),this._map.set(e,i),this.invalidate()}return}let e=[],i=[],r=this._pool.generateOpId(),s={},n={id:this._id,type:3,data:{}},a={};for(let o in t){let h=t[o];if(void 0===h)continue;let d=this._map.get(o);if(t5(d)?(i.push(...d._toOps(this._id,o)),d._detach()):void 0===d?i.push({type:6,id:this._id,key:o}):n.data[o]=d,t5(h)){h._setParentLink(this,o),h._attach(this._pool.generateId(),this._pool);let t=h._toOps(this._id,o,this._pool),i=t.find(t=>t.parentId===this._id);i&&this._propToLastUpdate.set(o,ta(i.opId)),e.push(...t)}else s[o]=h,this._propToLastUpdate.set(o,r);this._map.set(o,h),this.invalidate(),a[o]={type:"update"}}0!==Object.keys(n.data).length&&i.unshift(n),0!==Object.keys(s).length&&e.unshift({opId:r,id:this._id,type:3,data:s});let o=new Map;o.set(this._id,{node:this,type:"LiveObject",updates:a}),this._pool.dispatch(e,i,o)}toImmutable(){return super.toImmutable()}toTreeNode(t){return super.toTreeNode(t)}_toTreeNode(t){let e=this._id??tj();return{type:"LiveObject",id:e,key:t,payload:Array.from(this._map.entries()).map(([t,i])=>t5(i)?i.toTreeNode(t):{type:"Json",id:`${e}:${t}`,key:t,payload:i})}}_toImmutable(){let t={};for(let[e,i]of this._map)t[e]=t6(i)?i.toImmutable():i;return t}clone(){return new t(Object.fromEntries(Array.from(this._map).map(([t,e])=>[t,t6(e)?e.clone():tw(e)])))}};function t0(t){return t4(t2(t))}function t2(t){switch(t.type){case 8:return t.data;case 4:return new tZ(t.data);case 7:return new tQ;case 2:return new tq([]);default:return tn(t,"Unknown creation Op")}}function t1([t,e],i,r){switch(e.type){case 0:return tZ._deserialize([t,e],i,r);case 1:return tq._deserialize([t,e],i,r);case 2:return tQ._deserialize([t,e],i,r);case 3:return tz._deserialize([t,e],i,r);default:throw Error("Unexpected CRDT type")}}function t6(t){return function(t){return t instanceof tq}(t)||t instanceof tQ||function(t){return t instanceof tZ}(t)}function t5(t){return t6(t)||t instanceof tz}function t3(t){return t instanceof tz?t.data:t instanceof tq||t instanceof tQ||t instanceof tZ?t:tn(t,"Unknown AbstractCrdt")}function t4(t){return t instanceof tZ||t instanceof tQ||t instanceof tq?t:new tz(t)}var t8=/^[a-zA-Z_][a-zA-Z0-9_]*$/;function t7(t){let e=[],i=Object.entries(t),r=[],s=[],n=[];return i.forEach(([t,e])=>{if(!t8.test(t))throw Error("Key must only contain letters, numbers, _");ee(e)?r.push([t,e]):ei(e)?s.push([t,e]):"object"!=typeof e||"startsWith"in e||n.push([t,e])}),e=[...t9(r),...et(s)],n.forEach(([t,i])=>{let r=Object.entries(i),s=[],n=[];r.forEach(([e,i])=>{if(ea(e))throw Error("Key cannot be empty");ee(i)?s.push([es(t,e),i]):ei(i)&&n.push([es(t,e),i])}),e=[...e,...t9(s),...et(n)]}),e.map(({key:t,operator:e,value:i})=>er(t,e,en(i))).join(" AND ")}var t9=t=>{let e=[];return t.forEach(([t,i])=>{e.push({key:t,operator:":",value:i})}),e},et=t=>{let e=[];return t.forEach(([t,i])=>{"startsWith"in i&&"string"==typeof i.startsWith&&e.push({key:t,operator:"^",value:i.startsWith})}),e},ee=t=>"string"==typeof t||"number"==typeof t||"boolean"==typeof t,ei=t=>"object"==typeof t&&null!==t&&"startsWith"in t,er=(t,e,i)=>`${t}${e}${i}`,es=(t,e)=>e?`${t}[${JSON.stringify(e)}]`:t,en=t=>{if("string"==typeof t){if(ea(t))throw Error("Value cannot be empty");return JSON.stringify(t)}return t.toString()},ea=t=>!t||""===t.toString().trim(),eo=((o=eo||{})[o.UPDATE_PRESENCE=100]="UPDATE_PRESENCE",o[o.BROADCAST_EVENT=103]="BROADCAST_EVENT",o[o.FETCH_STORAGE=200]="FETCH_STORAGE",o[o.UPDATE_STORAGE=201]="UPDATE_STORAGE",o[o.FETCH_YDOC=300]="FETCH_YDOC",o[o.UPDATE_YDOC=301]="UPDATE_YDOC",o),eh={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ed=RegExp(Object.keys(eh).map(t=>`\\${t}`).join("|"),"g"),el=class{constructor(t,e){this._strings=t,this._values=e}toString(){return this._strings.reduce((t,e,i)=>{var r;return t+((r=ta(this._values[i-1]))instanceof el?r.toString():Array.isArray(r)?(r.length<=0?new el([""],[]):new el(["",...Array(r.length-1).fill(""),""],r)).toString():String(r).replace(ed,t=>eh[t]))+e})}},ec={_:"\\_","*":"\\*","#":"\\#","`":"\\`","~":"\\~","!":"\\!","|":"\\|","(":"\\(",")":"\\)","{":"\\{","}":"\\}","[":"\\[","]":"\\]"},eu=RegExp(Object.keys(ec).map(t=>`\\${t}`).join("|"),"g"),ep=class{constructor(t,e){this._strings=t,this._values=e}toString(){return this._strings.reduce((t,e,i)=>{var r;return t+((r=ta(this._values[i-1]))instanceof ep?r.toString():Array.isArray(r)?(r.length<=0?new ep([""],[]):new ep(["",...Array(r.length-1).fill(""),""],r)).toString():String(r).replace(eu,t=>ec[t]))+e})}};function e_(t){let e={};for(let i in t){let r=t[i];void 0!==r&&(e[i]=function t(e){return e instanceof tZ?e_(e.toObject()):e instanceof tq?e.toArray().map(t):e instanceof tQ?function(e){let i={};for(let[r,s]of e.entries())i[r]=t(s);return i}(e):e instanceof tz?e.data:Array.isArray(e)?e.map(t):ty(e)?e_(e):e}(r))}return e}function ef(t){if(Array.isArray(t))return new tq(t.map(ef));if(!ty(t))return t;{let e={};for(let i in t){let r=t[i];void 0!==r&&(e[i]=ef(r))}return new tZ(e)}}async function em(){return void 0!==globalThis.fetch?globalThis.fetch:(await i.e(876).then(i.bind(i,56876))).default}function ey(t){return"string"==typeof t&&t.length>0}function ew(t,e){if(!ey(t))throw Error(`Invalid value for field "${e}". Please provide a non-empty string. For more information: https://liveblocks.io/docs/api-reference/liveblocks-node#authorize`)}function eg(t){return t>=200&&t<300?200:t>=500?503:403}ts(tt,te,"esm"),i(2076),i(71877);var ev=Object.freeze(["room:write","room:read","room:presence:write","comments:write","comments:read"]),eE=Object.freeze(["room:read","room:presence:write","comments:read"]),eA=Object.freeze(["room:write","comments:write"]),eb=/^([*]|[^*]{1,128}[*]?)$/,eO=class{constructor(t,e,i){this.FULL_ACCESS=eA,this.READ_ACCESS=eE,this._sealed=!1,this._permissions=new Map,ew(e,"userId"),this._postFn=t,this._userId=e,this._userInfo=i}getOrCreate(t){if(this._sealed)throw Error("You can no longer change these permissions.");let e=this._permissions.get(t);if(e)return e;if(this._permissions.size>=10)throw Error("You cannot add permissions for more than 10 rooms in a single token");return e=new Set,this._permissions.set(t,e),e}allow(t,e){if("string"!=typeof t)throw Error("Room name or pattern must be a string");if(!eb.test(t))throw Error("Invalid room name or pattern");if(0===e.length)throw Error("Permission list cannot be empty");let i=this.getOrCreate(t);for(let t of e){if(!ev.includes(t))throw Error(`Not a valid permission: ${t}`);i.add(t)}return this}hasPermissions(){return this._permissions.size>0}seal(){if(this._sealed)throw Error("You cannot reuse Session instances. Please create a new session every time.");this._sealed=!0}serializePermissions(){return Object.fromEntries(Array.from(this._permissions.entries()).map(([t,e])=>[t,Array.from(e)]))}async authorize(){this.seal(),this.hasPermissions()||console.warn("Access tokens without any permission will not be supported soon, you should use wildcards when the client requests a token for resources outside a room. See https://liveblocks.io/docs/errors/liveblocks-client/access-tokens-not-enough-permissions");try{let t=await this._postFn(tC`/v2/authorize-user`,{userId:this._userId,permissions:this.serializePermissions(),userInfo:this._userInfo});return{status:eg(t.status),body:await t.text()}}catch(t){return{status:503,body:'Call to /v2/authorize-user failed. See "error" for more information.',error:t}}}},eS=class{constructor(t){let e=t.secret;(function(t,e){if(!ey(t)||!t.startsWith("sk_"))throw Error(`Invalid value for field "${e}". Secret keys must start with "sk_". Please provide the secret key from your Liveblocks dashboard at https://liveblocks.io/dashboard/apikeys.`)})(e,"secret"),this._secret=e,this._baseUrl=new URL(function(t){return"string"==typeof t&&t.startsWith("http")?t:"https://api.liveblocks.io"}(t.baseUrl))}async post(t,e){let i=tT(this._baseUrl,t),r={Authorization:`Bearer ${this._secret}`,"Content-Type":"application/json"},s=await em();return await s(i,{method:"POST",headers:r,body:JSON.stringify(e)})}async put(t,e){let i=tT(this._baseUrl,t),r={Authorization:`Bearer ${this._secret}`,"Content-Type":"application/json"},s=await em();return await s(i,{method:"PUT",headers:r,body:JSON.stringify(e)})}async putBinary(t,e,i){let r=tT(this._baseUrl,t,i),s={Authorization:`Bearer ${this._secret}`,"Content-Type":"application/octet-stream"},n=await em();return await n(r,{method:"PUT",headers:s,body:e})}async delete(t){let e=tT(this._baseUrl,t),i={Authorization:`Bearer ${this._secret}`},r=await em();return await r(e,{method:"DELETE",headers:i})}async get(t,e){let i=tT(this._baseUrl,t,e),r={Authorization:`Bearer ${this._secret}`},s=await em();return await s(i,{method:"GET",headers:r})}prepareSession(t,...e){let i=e[0];return new eO(this.post.bind(this),t,i?.userInfo)}async identifyUser(t,...e){let i=e[0],r=tC`/v2/identify-user`,s="string"==typeof t?t:t.userId,n="string"==typeof t?void 0:t.groupIds;ew(s,"userId");try{let t=await this.post(r,{userId:s,groupIds:n,userInfo:i?.userInfo});return{status:eg(t.status),body:await t.text()}}catch(t){return{status:503,body:`Call to ${tT(this._baseUrl,r)} failed. See "error" for more information.`,error:t}}}async getRooms(t={}){let e;let i=tC`/v2/rooms`;"string"==typeof t.query?e=t.query:"object"==typeof t.query&&(e=t7(t.query));let r={limit:t.limit,startingAfter:t.startingAfter,userId:t.userId,groupIds:t.groupIds?t.groupIds.join(","):void 0,...Object.fromEntries(Object.entries(t.metadata??{}).map(([t,e])=>[`metadata.${t}`,e])),query:e},s=await this.get(i,r);if(!s.ok){let t=await s.text();throw new eT(s.status,t)}let n=await s.json(),a=n.data.map(t=>{let e=t.lastConnectionAt?new Date(t.lastConnectionAt):void 0,i=new Date(t.createdAt);return{...t,createdAt:i,lastConnectionAt:e}});return{...n,data:a}}async createRoom(t,e){let{defaultAccesses:i,groupsAccesses:r,usersAccesses:s,metadata:n}=e,a=await this.post(tC`/v2/rooms`,{id:t,defaultAccesses:i,groupsAccesses:r,usersAccesses:s,metadata:n});if(!a.ok){let t=await a.text();throw new eT(a.status,t)}let o=await a.json(),h=o.lastConnectionAt?new Date(o.lastConnectionAt):void 0,d=new Date(o.createdAt);return{...o,lastConnectionAt:h,createdAt:d}}async getRoom(t){let e=await this.get(tC`/v2/rooms/${t}`);if(!e.ok){let t=await e.text();throw new eT(e.status,t)}let i=await e.json(),r=i.lastConnectionAt?new Date(i.lastConnectionAt):void 0,s=new Date(i.createdAt);return{...i,createdAt:s,lastConnectionAt:r}}async updateRoom(t,e){let{defaultAccesses:i,groupsAccesses:r,usersAccesses:s,metadata:n}=e,a=await this.post(tC`/v2/rooms/${t}`,{defaultAccesses:i,groupsAccesses:r,usersAccesses:s,metadata:n});if(!a.ok){let t=await a.text();throw new eT(a.status,t)}let o=await a.json(),h=o.lastConnectionAt?new Date(o.lastConnectionAt):void 0,d=new Date(o.createdAt);return{...o,lastConnectionAt:h,createdAt:d}}async deleteRoom(t){let e=await this.delete(tC`/v2/rooms/${t}`);if(!e.ok){let t=await e.text();throw new eT(e.status,t)}}async getActiveUsers(t){let e=await this.get(tC`/v2/rooms/${t}/active_users`);if(!e.ok){let t=await e.text();throw new eT(e.status,t)}return await e.json()}async broadcastEvent(t,e){let i=await this.post(tC`/v2/rooms/${t}/broadcast_event`,e);if(!i.ok){let t=await i.text();throw new eT(i.status,t)}}async getStorageDocument(t,e="plain-lson"){let i=await this.get(tC`/v2/rooms/${t}/storage`,{format:e});if(!i.ok){let t=await i.text();throw new eT(i.status,t)}return await i.json()}async initializeStorageDocument(t,e){let i=await this.post(tC`/v2/rooms/${t}/storage`,e);if(!i.ok){let t=await i.text();throw new eT(i.status,t)}return await i.json()}async deleteStorageDocument(t){let e=await this.delete(tC`/v2/rooms/${t}/storage`);if(!e.ok){let t=await e.text();throw new eT(e.status,t)}}async getYjsDocument(t,e={}){let{format:i,key:r,type:s}=e,n=tC`v2/rooms/${t}/ydoc`,a=await this.get(n,{formatting:i?"true":void 0,key:r,type:s});if(!a.ok){let t=await a.text();throw new eT(a.status,t)}return await a.json()}async sendYjsBinaryUpdate(t,e,i={}){let r=await this.putBinary(tC`/v2/rooms/${t}/ydoc`,e,{guid:i.guid});if(!r.ok){let t=await r.text();throw new eT(r.status,t)}}async getYjsDocumentAsBinaryUpdate(t,e={}){let i=await this.get(tC`/v2/rooms/${t}/ydoc-binary`,{guid:e.guid});if(!i.ok){let t=await i.text();throw new eT(i.status,t)}return i.arrayBuffer()}async createSchema(t,e){let i=await this.post(tC`/v2/schemas`,{name:t,body:e});if(!i.ok){let t=await i.text();throw new eT(i.status,t)}let r=await i.json(),s=new Date(r.createdAt),n=new Date(r.updatedAt);return{...r,createdAt:s,updatedAt:n}}async getSchema(t){let e=await this.get(tC`/v2/schemas/${t}`);if(!e.ok){let t=await e.text();throw new eT(e.status,t)}let i=await e.json(),r=new Date(i.createdAt),s=new Date(i.updatedAt);return{...i,createdAt:r,updatedAt:s}}async updateSchema(t,e){let i=await this.put(tC`/v2/schemas/${t}`,{body:e});if(!i.ok){let t=await i.text();throw new eT(i.status,t)}let r=await i.json(),s=new Date(r.createdAt),n=new Date(r.updatedAt);return{...r,createdAt:s,updatedAt:n}}async deleteSchema(t){let e=await this.delete(tC`/v2/schemas/${t}`);if(!e.ok){let t=await e.text();throw new eT(e.status,t)}}async getSchemaByRoomId(t){let e=await this.get(tC`/v2/rooms/${t}/schema`);if(!e.ok){let t=await e.text();throw new eT(e.status,t)}let i=await e.json(),r=new Date(i.createdAt),s=new Date(i.updatedAt);return{...i,createdAt:r,updatedAt:s}}async attachSchemaToRoom(t,e){let i=await this.post(tC`/v2/rooms/${t}/schema`,{schema:e});if(!i.ok){let t=await i.text();throw new eT(i.status,t)}return await i.json()}async detachSchemaFromRoom(t){let e=await this.delete(tC`/v2/rooms/${t}/schema`);if(!e.ok){let t=await e.text();throw new eT(e.status,t)}}async getThreads(t){let e;let{roomId:i}=t;"string"==typeof t.query?e=t.query:"object"==typeof t.query&&(e=t7(t.query));let r=await this.get(tC`/v2/rooms/${i}/threads`,{query:e});if(!r.ok){let t=await r.text();throw new eT(r.status,t)}let{data:s}=await r.json();return{data:s.map(t=>tO(t))}}async getThread(t){let{roomId:e,threadId:i}=t,r=await this.get(tC`/v2/rooms/${e}/threads/${i}`);if(!r.ok){let t=await r.text();throw new eT(r.status,t)}return tO(await r.json())}async getThreadParticipants(t){let{roomId:e,threadId:i}=t,r=await this.get(tC`/v2/rooms/${e}/threads/${i}/participants`);if(!r.ok){let t=await r.text();throw new eT(r.status,t)}return await r.json()}async getComment(t){let{roomId:e,threadId:i,commentId:r}=t,s=await this.get(tC`/v2/rooms/${e}/threads/${i}/comments/${r}`);if(!s.ok){let t=await s.text();throw new eT(s.status,t)}return tb(await s.json())}async createComment(t){let{roomId:e,threadId:i,data:r}=t,s=await this.post(tC`/v2/rooms/${e}/threads/${i}/comments`,{...r,createdAt:r.createdAt?.toISOString()});if(!s.ok){let t=await s.text();throw new eT(s.status,t)}return tb(await s.json())}async editComment(t){let{roomId:e,threadId:i,commentId:r,data:s}=t,n=await this.post(tC`/v2/rooms/${e}/threads/${i}/comments/${r}`,{...s,editedAt:s.editedAt?.toISOString()});if(!n.ok){let t=await n.text();throw new eT(n.status,t)}return tb(await n.json())}async deleteComment(t){let{roomId:e,threadId:i,commentId:r}=t,s=await this.delete(tC`/v2/rooms/${e}/threads/${i}/comments/${r}`);if(!s.ok){let t=await s.text();throw new eT(s.status,t)}}async createThread(t){let{roomId:e,data:i}=t,r=await this.post(tC`/v2/rooms/${e}/threads`,{...i,comment:{...i.comment,createdAt:i.comment.createdAt?.toISOString()}});if(!r.ok){let t=await r.text();throw new eT(r.status,t)}return tO(await r.json())}async deleteThread(t){let{roomId:e,threadId:i}=t,r=await this.delete(tC`/v2/rooms/${e}/threads/${i}`);if(!r.ok){let t=await r.text();throw new eT(r.status,t)}}async markThreadAsResolved(t){let{roomId:e,threadId:i}=t,r=await this.post(tC`/v2/rooms/${e}/threads/${i}/mark-as-resolved`,{});if(!r.ok){let t=await r.text();throw new eT(r.status,t)}return tO(await r.json())}async markThreadAsUnresolved(t){let{roomId:e,threadId:i}=t,r=await this.post(tC`/v2/rooms/${e}/threads/${i}/mark-as-unresolved`,{});if(!r.ok){let t=await r.text();throw new eT(r.status,t)}return tO(await r.json())}async editThreadMetadata(t){let{roomId:e,threadId:i,data:r}=t,s=await this.post(tC`/v2/rooms/${e}/threads/${i}/metadata`,{...r,updatedAt:r.updatedAt?.toISOString()});if(!s.ok){let t=await s.text();throw new eT(s.status,t)}return await s.json()}async addCommentReaction(t){var e;let{roomId:i,threadId:r,commentId:s,data:n}=t,a=await this.post(tC`/v2/rooms/${i}/threads/${r}/comments/${s}/add-reaction`,{...n,createdAt:n.createdAt?.toISOString()});if(!a.ok){let t=await a.text();throw new eT(a.status,t)}return{...e=await a.json(),createdAt:new Date(e.createdAt)}}async removeCommentReaction(t){let{roomId:e,threadId:i,data:r}=t,s=await this.post(tC`/v2/rooms/${e}/threads/${i}/comments/${t.commentId}/remove-reaction`,{...r,removedAt:r.removedAt?.toISOString()});if(!s.ok){let t=await s.text();throw new eT(s.status,t)}}async getInboxNotification(t){let{userId:e,inboxNotificationId:i}=t,r=await this.get(tC`/v2/users/${e}/inbox-notifications/${i}`);if(!r.ok){let t=await r.text();throw new eT(r.status,t)}return tS(await r.json())}async getInboxNotifications(t){let e;let{userId:i}=t;"string"==typeof t.query?e=t.query:"object"==typeof t.query&&(e=t7(t.query));let r=await this.get(tC`/v2/users/${i}/inbox-notifications`,{query:e});if(!r.ok){let t=await r.text();throw new eT(r.status,t)}let{data:s}=await r.json();return{data:s.map(tS)}}async getRoomNotificationSettings(t){let{userId:e,roomId:i}=t,r=await this.get(tC`/v2/rooms/${i}/users/${e}/notification-settings`);if(!r.ok){let t=await r.text();throw new eT(r.status,t)}return await r.json()}async updateRoomNotificationSettings(t){let{userId:e,roomId:i,data:r}=t,s=await this.post(tC`/v2/rooms/${i}/users/${e}/notification-settings`,r);if(!s.ok){let t=await s.text();throw new eT(s.status,t)}return await s.json()}async deleteRoomNotificationSettings(t){let{userId:e,roomId:i}=t,r=await this.delete(tC`/v2/rooms/${i}/users/${e}/notification-settings`);if(!r.ok){let t=await r.text();throw new eT(r.status,t)}}async updateRoomId(t){let{currentRoomId:e,newRoomId:i}=t,r=await this.post(tC`/v2/rooms/${e}/update-room-id`,{newRoomId:i});if(!r.ok){let t=await r.text();throw new eT(r.status,t)}let s=await r.json();return{...s,createdAt:new Date(s.createdAt),lastConnectionAt:s.lastConnectionAt?new Date(s.lastConnectionAt):void 0}}async triggerInboxNotification(t){let e=await this.post(tC`/v2/inbox-notifications/trigger`,t);if(!e.ok){let t=await e.text();throw new eT(e.status,t)}}async deleteInboxNotification(t){let{userId:e,inboxNotificationId:i}=t,r=await this.delete(tC`/v2/users/${e}/inbox-notifications/${i}`);if(!r.ok){let t=await r.text();throw new eT(r.status,t)}}async deleteAllInboxNotifications(t){let{userId:e}=t,i=await this.delete(tC`/v2/users/${e}/inbox-notifications`);if(!i.ok){let t=await i.text();throw new eT(i.status,t)}}},eT=class extends Error{constructor(t,e=""){super(e),this.name="LiveblocksError",this.status=t}};ts("@liveblocks/node","2.8.2","esm");let eC=new eS({secret:process.env.LIVEBLOCK_SK});async function eI(t){let e=await Q(),i=eC.prepareSession(e?.primaryEmailAddress?.emailAddress),{room:r}=await t.json(),{searchParams:s}=new URL(t?.url),n=s.get("roomId");console.log(r),i.allow(n,i?.FULL_ACCESS);let{status:a,body:o}=await i.authorize();return new Response(o,{status:a})}let ek=new I.AppRouteRouteModule({definition:{kind:k.x.APP_ROUTE,page:"/api/liveblocks-auth/route",pathname:"/api/liveblocks-auth",filename:"route",bundlePath:"app/api/liveblocks-auth/route"},resolvedPagePath:"C:\\Users\\kommi\\OneDrive\\Desktop\\PROJECTS\\Document Planner\\document-planner-app\\app\\api\\liveblocks-auth\\route.ts",nextConfigOutput:"",userland:C}),{requestAsyncStorage:eP,staticGenerationAsyncStorage:ex,serverHooks:eR}=ek,eD="/api/liveblocks-auth/route";function eL(){return(0,P.patchFetch)({serverHooks:eR,staticGenerationAsyncStorage:ex})}},2076:function(t,e){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t){void 0===t&&(t="="),this._paddingCharacter=t}return t.prototype.encodedLength=function(t){return this._paddingCharacter?(t+2)/3*4|0:(8*t+5)/6|0},t.prototype.encode=function(t){for(var e="",i=0;i<t.length-2;i+=3){var r=t[i]<<16|t[i+1]<<8|t[i+2];e+=this._encodeByte(r>>>18&63)+this._encodeByte(r>>>12&63)+this._encodeByte(r>>>6&63)+this._encodeByte(r>>>0&63)}var s=t.length-i;if(s>0){var r=t[i]<<16|(2===s?t[i+1]<<8:0);e+=this._encodeByte(r>>>18&63)+this._encodeByte(r>>>12&63),2===s?e+=this._encodeByte(r>>>6&63):e+=this._paddingCharacter||"",e+=this._paddingCharacter||""}return e},t.prototype.maxDecodedLength=function(t){return this._paddingCharacter?t/4*3|0:(6*t+7)/8|0},t.prototype.decodedLength=function(t){return this.maxDecodedLength(t.length-this._getPaddingLength(t))},t.prototype.decode=function(t){if(0===t.length)return new Uint8Array(0);for(var e=this._getPaddingLength(t),i=t.length-e,r=new Uint8Array(this.maxDecodedLength(i)),s=0,n=0,a=0,o=0,h=0,d=0,l=0;n<i-4;n+=4)o=this._decodeChar(t.charCodeAt(n+0)),h=this._decodeChar(t.charCodeAt(n+1)),d=this._decodeChar(t.charCodeAt(n+2)),l=this._decodeChar(t.charCodeAt(n+3)),r[s++]=o<<2|h>>>4,r[s++]=h<<4|d>>>2,r[s++]=d<<6|l,a|=256&o,a|=256&h,a|=256&d,a|=256&l;if(n<i-1&&(o=this._decodeChar(t.charCodeAt(n)),h=this._decodeChar(t.charCodeAt(n+1)),r[s++]=o<<2|h>>>4,a|=256&o,a|=256&h),n<i-2&&(d=this._decodeChar(t.charCodeAt(n+2)),r[s++]=h<<4|d>>>2,a|=256&d),n<i-3&&(l=this._decodeChar(t.charCodeAt(n+3)),r[s++]=d<<6|l,a|=256&l),0!==a)throw Error("Base64Coder: incorrect characters for decoding");return r},t.prototype._encodeByte=function(t){var e=t;return String.fromCharCode(e+=65+(25-t>>>8&6)+(51-t>>>8&-75)+(61-t>>>8&-15)+(62-t>>>8&3))},t.prototype._decodeChar=function(t){return 256+((42-t&t-44)>>>8&-256+t-43+62)+((46-t&t-48)>>>8&-256+t-47+63)+((47-t&t-58)>>>8&-256+t-48+52)+((64-t&t-91)>>>8&-256+t-65+0)+((96-t&t-123)>>>8&-256+t-97+26)},t.prototype._getPaddingLength=function(t){var e=0;if(this._paddingCharacter){for(var i=t.length-1;i>=0&&t[i]===this._paddingCharacter;i--)e++;if(t.length<4||e>2)throw Error("Base64Coder: incorrect padding")}return e},t}();e.Coder=s;var n=new s;e.encode=function(t){return n.encode(t)},e.decode=function(t){return n.decode(t)};var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._encodeByte=function(t){var e=t;return String.fromCharCode(e+=65+(25-t>>>8&6)+(51-t>>>8&-75)+(61-t>>>8&-13)+(62-t>>>8&49))},e.prototype._decodeChar=function(t){return 256+((44-t&t-46)>>>8&-256+t-45+62)+((94-t&t-96)>>>8&-256+t-95+63)+((47-t&t-58)>>>8&-256+t-48+52)+((64-t&t-91)>>>8&-256+t-65+0)+((96-t&t-123)>>>8&-256+t-97+26)},e}(s);e.URLSafeCoder=a;var o=new a;e.encodeURLSafe=function(t){return o.encode(t)},e.decodeURLSafe=function(t){return o.decode(t)},e.encodedLength=function(t){return n.encodedLength(t)},e.maxDecodedLength=function(t){return n.maxDecodedLength(t)},e.decodedLength=function(t){return n.decodedLength(t)}},71877:function(t,e,i){var r;!function(e,s){var n={};s(n);var a=n.default;for(var o in n)a[o]=n[o];"object"==typeof t.exports?t.exports=a:void 0!==(r=(function(){return a}).call(n,i,n,t))&&(t.exports=r)}(0,function(t){"use strict";t.__esModule=!0,t.digestLength=32,t.blockSize=64;var e=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function i(t,i,r,s,n){for(var a,o,h,d,l,c,u,p,_,f,m,y,w;n>=64;){for(f=0,a=i[0],o=i[1],h=i[2],d=i[3],l=i[4],c=i[5],u=i[6],p=i[7];f<16;f++)m=s+4*f,t[f]=(255&r[m])<<24|(255&r[m+1])<<16|(255&r[m+2])<<8|255&r[m+3];for(f=16;f<64;f++)y=((_=t[f-2])>>>17|_<<15)^(_>>>19|_<<13)^_>>>10,w=((_=t[f-15])>>>7|_<<25)^(_>>>18|_<<14)^_>>>3,t[f]=(y+t[f-7]|0)+(w+t[f-16]|0);for(f=0;f<64;f++)y=(((l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7))+(l&c^~l&u)|0)+(p+(e[f]+t[f]|0)|0)|0,w=((a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10))+(a&o^a&h^o&h)|0,p=u,u=c,c=l,l=d+y|0,d=h,h=o,o=a,a=y+w|0;i[0]+=a,i[1]+=o,i[2]+=h,i[3]+=d,i[4]+=l,i[5]+=c,i[6]+=u,i[7]+=p,s+=64,n-=64}return s}var r=function(){function e(){this.digestLength=t.digestLength,this.blockSize=t.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return e.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},e.prototype.clean=function(){for(var t=0;t<this.buffer.length;t++)this.buffer[t]=0;for(var t=0;t<this.temp.length;t++)this.temp[t]=0;this.reset()},e.prototype.update=function(t,e){if(void 0===e&&(e=t.length),this.finished)throw Error("SHA256: can't update because hash was finished.");var r=0;if(this.bytesHashed+=e,this.bufferLength>0){for(;this.bufferLength<64&&e>0;)this.buffer[this.bufferLength++]=t[r++],e--;64===this.bufferLength&&(i(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(e>=64&&(r=i(this.temp,this.state,t,r,e),e%=64);e>0;)this.buffer[this.bufferLength++]=t[r++],e--;return this},e.prototype.finish=function(t){if(!this.finished){var e=this.bytesHashed,r=this.bufferLength,s=e/536870912|0,n=e<<3,a=e%64<56?64:128;this.buffer[r]=128;for(var o=r+1;o<a-8;o++)this.buffer[o]=0;this.buffer[a-8]=s>>>24&255,this.buffer[a-7]=s>>>16&255,this.buffer[a-6]=s>>>8&255,this.buffer[a-5]=s>>>0&255,this.buffer[a-4]=n>>>24&255,this.buffer[a-3]=n>>>16&255,this.buffer[a-2]=n>>>8&255,this.buffer[a-1]=n>>>0&255,i(this.temp,this.state,this.buffer,0,a),this.finished=!0}for(var o=0;o<8;o++)t[4*o+0]=this.state[o]>>>24&255,t[4*o+1]=this.state[o]>>>16&255,t[4*o+2]=this.state[o]>>>8&255,t[4*o+3]=this.state[o]>>>0&255;return this},e.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},e.prototype._saveState=function(t){for(var e=0;e<this.state.length;e++)t[e]=this.state[e]},e.prototype._restoreState=function(t,e){for(var i=0;i<this.state.length;i++)this.state[i]=t[i];this.bytesHashed=e,this.finished=!1,this.bufferLength=0},e}();t.Hash=r;var s=function(){function t(t){this.inner=new r,this.outer=new r,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var e=new Uint8Array(this.blockSize);if(t.length>this.blockSize)new r().update(t).finish(e).clean();else for(var i=0;i<t.length;i++)e[i]=t[i];for(var i=0;i<e.length;i++)e[i]^=54;this.inner.update(e);for(var i=0;i<e.length;i++)e[i]^=106;this.outer.update(e),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var i=0;i<e.length;i++)e[i]=0}return t.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},t.prototype.clean=function(){for(var t=0;t<this.istate.length;t++)this.ostate[t]=this.istate[t]=0;this.inner.clean(),this.outer.clean()},t.prototype.update=function(t){return this.inner.update(t),this},t.prototype.finish=function(t){return this.outer.finished?this.outer.finish(t):(this.inner.finish(t),this.outer.update(t,this.digestLength).finish(t)),this},t.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},t}();function n(t){var e=new r().update(t),i=e.digest();return e.clean(),i}function a(t,e){var i=new s(t).update(e),r=i.digest();return i.clean(),r}t.HMAC=s,t.hash=n,t.default=n,t.hmac=a;var o=new Uint8Array(t.digestLength);t.hkdf=function(t,e,i,r){void 0===e&&(e=o),void 0===r&&(r=32);for(var n=new Uint8Array([1]),h=new s(a(e,t)),d=new Uint8Array(h.digestLength),l=d.length,c=new Uint8Array(r),u=0;u<r;u++)l===d.length&&(function(t,e,i,r){var s=r[0];if(0===s)throw Error("hkdf: cannot expand more");e.reset(),s>1&&e.update(t),i&&e.update(i),e.update(r),e.finish(t),r[0]++}(d,h,i,n),l=0),c[u]=d[l++];return h.clean(),d.fill(0),n.fill(0),c},t.pbkdf2=function(t,e,i,r){for(var n=new s(t),a=n.digestLength,o=new Uint8Array(4),h=new Uint8Array(a),d=new Uint8Array(a),l=new Uint8Array(r),c=0;c*a<r;c++){var u=c+1;o[0]=u>>>24&255,o[1]=u>>>16&255,o[2]=u>>>8&255,o[3]=u>>>0&255,n.reset(),n.update(e),n.update(o),n.finish(d);for(var p=0;p<a;p++)h[p]=d[p];for(var p=2;p<=i;p++){n.reset(),n.update(d).finish(d);for(var _=0;_<a;_++)h[_]^=d[_]}for(var p=0;p<a&&c*a+p<r;p++)l[c*a+p]=h[p]}for(var c=0;c<a;c++)h[c]=d[c]=0;for(var c=0;c<4;c++)o[c]=0;return n.clean(),l}})},73278:(t,e,i)=>{"use strict";t.exports=i(30517)}};var e=require("../../../webpack-runtime.js");e.C(t);var i=t=>e(e.s=t),r=e.X(0,[379,819],()=>i(72705));module.exports=r})();